<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plataforma de Consultas</title>
    <!-- Enlace al archivo CSS compilado -->
    <link href="output.css" rel="stylesheet">
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Estilos personalizados */
        .loader {
            border-top-color: #60a5fa;
            -webkit-animation: spinner 1.5s linear infinite;
            animation: spinner 1.5s linear infinite;
        }
        @-webkit-keyframes spinner {
            0% { -webkit-transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); }
        }
        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Ocultar los radio buttons reales */
        .tab-radio {
            display: none;
        }
        /* Estilo para las etiquetas que actúan como pestañas */
        .tab-label {
            transition: all 0.3s ease;
        }
        /* Estilo para la pestaña seleccionada */
        .tab-radio:checked + .tab-label {
            background-color: #3b82f6;
            border-color: #3b82f6;
            color: white;
        }
        /* Estilo para el date picker en modo oscuro */
        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(1);
        }
        input[type="month"]::-webkit-calendar-picker-indicator {
            filter: invert(1);
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-300 font-sans">

    <div class="container mx-auto p-4 md:p-8 max-w-2xl">
        
        <!-- Selector de Pestañas -->
        <div class="flex flex-wrap justify-center gap-2 md:gap-4 mb-8">
            <input type="radio" name="tabs" id="tab-dni" class="tab-radio" checked>
            <label for="tab-dni" class="tab-label border border-gray-600 rounded-full px-4 py-2 cursor-pointer hover:bg-gray-700">D.N.I.</label>
            
            <input type="radio" name="tabs" id="tab-ruc" class="tab-radio">
            <label for="tab-ruc" class="tab-label border border-gray-600 rounded-full px-4 py-2 cursor-pointer hover:bg-gray-700">R.U.C.</label>

            <input type="radio" name="tabs" id="tab-exchange" class="tab-radio">
            <label for="tab-exchange" class="tab-label border border-gray-600 rounded-full px-4 py-2 cursor-pointer hover:bg-gray-700">Tipo de Cambio</label>
            
            <input type="radio" name="tabs" id="tab-afp" class="tab-radio">
            <label for="tab-afp" class="tab-label border border-gray-600 rounded-full px-4 py-2 cursor-pointer hover:bg-gray-700">Comisiones AFP</label>
        </div>

        <!-- Formularios de Consulta -->
        <div class="bg-gray-800 p-6 rounded-xl shadow-2xl">
            <div id="form-dni" class="tab-content">
                <input type="text" id="dniInput" placeholder="Ej. 00000000" maxlength="8" class="w-full bg-gray-900 border border-gray-600 rounded-lg p-4 text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none text-center text-lg tracking-widest">
            </div>
            <div id="form-ruc" class="tab-content hidden">
                <input type="text" id="rucInput" placeholder="Ej. 00000000000" maxlength="11" class="w-full bg-gray-900 border border-gray-600 rounded-lg p-4 text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none text-center text-lg tracking-widest">
            </div>
            <div id="form-exchange" class="tab-content hidden flex flex-col md:flex-row gap-4">
                <input type="date" id="exchangeDateInput" class="w-full md:w-1/2 bg-gray-900 border border-gray-600 rounded-lg p-4 text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none text-center text-lg">
                <select id="exchangeCurrencyInput" class="w-full md:w-1/2 bg-gray-900 border border-gray-600 rounded-lg p-4 text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none text-center text-lg">
                    <option value="USD">Dólar (USD)</option>
                    <option value="EUR">Euro (EUR)</option>
                    <option value="GBP">Libra (GBP)</option>
                </select>
            </div>
            <div id="form-afp" class="tab-content hidden">
                <input type="month" id="afpPeriodoInput" class="w-full bg-gray-900 border border-gray-600 rounded-lg p-4 text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none text-center text-lg">
            </div>
            
            <button id="consultarBtn" class="mt-4 w-full bg-white text-gray-900 font-bold py-4 rounded-lg flex items-center justify-center gap-2 hover:bg-gray-200 transition-colors duration-300 text-lg">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                CONSULTAR
            </button>
        </div>

        <!-- Tarjeta de Resultados -->
        <div id="resultadoWrapper" class="mt-8 border border-gray-700 rounded-xl p-6 bg-gray-800/50 min-h-[250px] hidden">
            <h3 class="text-center text-blue-400 font-bold mb-4 tracking-widest" id="resultadoTitulo">INFORMACIÓN</h3>
            <div id="resultadoContenido" class="space-y-2">
                <!-- El contenido se inyectará aquí -->
            </div>
        </div>
        
        <!-- Spinner de carga -->
        <div id="loader" class="hidden fixed top-0 left-0 w-full h-full bg-gray-900 bg-opacity-80 flex justify-center items-center z-50">
            <div class="loader ease-linear rounded-full border-8 border-t-8 border-gray-600 h-32 w-32"></div>
        </div>
    </div>

    <script>
        // --- CONFIGURACIÓN ---
        const apiToken = '168a416d37be397b254bec8d46178b16c7fc6699298e5f596b3e8d2c42a3008a';
        const loader = document.getElementById('loader');

        // --- MANEJO DE PESTAÑAS ---
        const tabs = document.querySelectorAll('.tab-radio');
        const contents = document.querySelectorAll('.tab-content');
        tabs.forEach(tab => {
            tab.addEventListener('change', () => {
                contents.forEach(content => content.classList.add('hidden'));
                document.getElementById(`form-${tab.id.split('-')[1]}`).classList.remove('hidden');
            });
        });

        // --- LÓGICA DE CONSULTA ---
        const consultarBtn = document.getElementById('consultarBtn');
        consultarBtn.addEventListener('click', () => {
            const activeTabId = document.querySelector('.tab-radio:checked').id;
            const activeTab = activeTabId.split('-')[1]; // dni, ruc, exchange, afp

            switch (activeTab) {
                case 'dni': handleDniQuery(); break;
                case 'ruc': handleRucQuery(); break;
                case 'exchange': handleExchangeQuery(); break;
                case 'afp': handleAfpQuery(); break;
            }
        });

        const resultadoWrapper = document.getElementById('resultadoWrapper');
        const resultadoTitulo = document.getElementById('resultadoTitulo');
        const resultadoContenido = document.getElementById('resultadoContenido');

        function createResultItem(label, value) {
            return `<div class="flex justify-between py-2 border-b border-gray-700/50"><span class="font-semibold text-gray-400">${label}:</span><span class="font-bold text-right">${value}</span></div>`;
        }

        function showLoading(title) {
            loader.classList.remove('hidden');
            resultadoWrapper.classList.remove('hidden');
            resultadoContenido.innerHTML = '<p class="text-center text-gray-400">Consultando...</p>';
            resultadoTitulo.textContent = title;
        }

        function hideLoading() {
            loader.classList.add('hidden');
        }

        function showError(message) {
             resultadoContenido.innerHTML = `<p class="text-center text-red-400"><b>Error:</b> ${message}</p>`;
        }

        // --- MANEJADORES POR TIPO DE CONSULTA ---
        function handleDniQuery() {
            const dni = document.getElementById('dniInput').value.trim();
            if (dni.length !== 8 || !/^\d+$/.test(dni)) {
                alert("Por favor, ingresa un DNI válido de 8 dígitos.");
                return;
            }
            consultarDocumento('dni', dni);
        }

        function handleRucQuery() {
            const ruc = document.getElementById('rucInput').value.trim();
            if (ruc.length !== 11 || !/^\d+$/.test(ruc)) {
                alert("Por favor, ingresa un RUC válido de 11 dígitos.");
                return;
            }
            consultarDocumento('ruc', ruc);
        }
        
        async function consultarDocumento(tipoDoc, numeroDoc) {
            showLoading(`INFORMACIÓN ${tipoDoc.toUpperCase()}`);
            try {
                const apiURL = 'https://api.consultasperu.com/api/v1/query';
                const requestBody = { token: apiToken, type_document: tipoDoc, document_number: numeroDoc };
                const response = await fetch(apiURL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });
                const data = await response.json();

                if (data.success) {
                    const info = data.data;
                    let html = '';
                    if (tipoDoc === 'dni') {
                        html += createResultItem('Número de documento', info.number || 'N/A');
                        html += createResultItem('Nombre completo', info.full_name || 'N/A');
                        html += createResultItem('Fecha Nacimiento', info.date_of_birth || 'N/A');
                        html += createResultItem('Departamento', info.department || 'N/A');
                        html += createResultItem('Provincia', info.province || 'N/A');
                        html += createResultItem('Distrito', info.district || 'N/A');
                    } else if (tipoDoc === 'ruc') {
                        html += createResultItem('Número de RUC', info.number || 'N/A');
                        html += createResultItem('Razón Social', info.name || 'N/A');
                        html += createResultItem('Estado', `<span class="${info.status === 'ACTIVO' ? 'text-green-400' : 'text-red-400'}">${info.status}</span>`);
                        html += createResultItem('Condición', `<span class="${info.domicile_conditions === 'HABIDO' ? 'text-green-400' : 'text-red-400'}">${info.domicile_conditions}</span>`);
                        html += createResultItem('Dirección', info.address || 'N/A');
                    }
                    resultadoContenido.innerHTML = html;
                } else {
                    throw new Error(data.message || 'La consulta no tuvo éxito.');
                }
            } catch (error) {
                showError(error.message);
            } finally {
                hideLoading();
            }
        }

        async function handleExchangeQuery() {
            const date = document.getElementById('exchangeDateInput').value;
            const currency = document.getElementById('exchangeCurrencyInput').value;
            if (!date) {
                alert("Por favor, selecciona una fecha.");
                return;
            }
            showLoading('TIPO DE CAMBIO');

            try {
                const apiURL = 'https://api.consultasperu.com/api/v1/query/exchange-rate';
                const requestBody = { token: apiToken, start_date: date, end_date: date, currency: currency };
                const response = await fetch(apiURL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });
                const data = await response.json();

                if (data.success) {
                    const info = data.data;
                    let html = '';
                    html += createResultItem('Fecha', info.date);
                    html += createResultItem('Moneda', info.currency);
                    html += createResultItem('Compra', `<span class="text-xl text-green-400">S/ ${info.buy}</span>`);
                    html += createResultItem('Venta', `<span class="text-xl text-blue-400">S/ ${info.sale}</span>`);
                    resultadoContenido.innerHTML = html;
                } else {
                    throw new Error(data.message || 'La consulta no tuvo éxito.');
                }
            } catch (error) {
                showError(error.message);
            } finally {
                hideLoading();
            }
        }

        async function handleAfpQuery() {
            const periodo = document.getElementById('afpPeriodoInput').value;
            if (!periodo) {
                alert("Por favor, selecciona un período.");
                return;
            }
            showLoading('COMISIONES AFP');

            try {
                const apiURL = 'https://api.consultasperu.com/api/v1/query/comisiones-afp';
                const requestBody = { token: apiToken, periodo: periodo };
                const response = await fetch(apiURL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });
                const data = await response.json();

                if (data.success && Array.isArray(data.data)) {
                    let tablaHTML = `<table class="w-full text-sm"><thead><tr class="border-b border-gray-700"><th class="p-2 text-left font-bold">AFP</th><th class="p-2 text-right font-bold">C. Flujo</th><th class="p-2 text-right font-bold">P. Seguro</th></tr></thead><tbody>`;
                    data.data.forEach(afp => {
                        tablaHTML += `<tr class="border-b border-gray-700/50"><td class="p-2 font-semibold">${afp.afp}</td><td class="p-2 text-right">${afp.comision_sobre_flujo}%</td><td class="p-2 text-right">${afp.prima_de_seguro}%</td></tr>`;
                    });
                    tablaHTML += `</tbody></table>`;
                    resultadoContenido.innerHTML = tablaHTML;
                } else {
                    throw new Error(data.message || 'La consulta no devolvió datos válidos.');
                }
            } catch (error) {
                showError(error.message);
            } finally {
                hideLoading();
            }
        }

        // --- INICIALIZACIÓN ---
        function setInitialDates() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('exchangeDateInput').value = today;

            const now = new Date();
            const year = now.getFullYear();
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            document.getElementById('afpPeriodoInput').value = `${year}-${month}`;
        }
        setInitialDates();
    </script>

</body>
</html>
